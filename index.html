<!DOCTYPE html>
  <head>
    <title>MakeplaceToTeamcraft</title>
    <meta charset="utf8">
    <script src="https://unpkg.com/alpinejs@3.3.3/dist/cdn.min.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script id="dyes" type="application/json">
      [{"Name":"Abyssal Blue Dye","Hex":"312D57FF","ID":5804},{"Name":"Acorn Brown Dye","Hex":"8E581BFF","ID":5755},{"Name":"Adamantoise Green Dye","Hex":"5F7558FF","ID":5782},{"Name":"Aldgoat Brown Dye","Hex":"A2875CFF","ID":5753},{"Name":"Apple Green Dye","Hex":"9BB363FF","ID":5778},{"Name":"Ash Grey Dye","Hex":"ACA8A2FF","ID":5730},{"Name":"Bark Brown Dye","Hex":"6A4B37FF","ID":5746},{"Name":"Blood Red Dye","Hex":"913B27FF","ID":5742},{"Name":"Bone White Dye","Hex":"EBD3A0FF","ID":5762},{"Name":"Cactuar Green Dye","Hex":"658241FF","ID":5779},{"Name":"Canary Yellow Dye","Hex":"FEF864FF","ID":30118},{"Name":"Celeste Green Dye","Hex":"96BDB9FF","ID":5785},{"Name":"Ceruleum Blue Dye","Hex":"4F5766FF","ID":5794},{"Name":"Charcoal Grey Dye","Hex":"484742FF","ID":5733},{"Name":"Cherry Pink Dye","Hex":"F5379BFF","ID":30117},{"Name":"Chestnut Brown Dye","Hex":"3D290DFF","ID":5757},{"Name":"Chocolate Brown Dye","Hex":"6E3D24FF","ID":5747},{"Name":"Coeurl Yellow Dye","Hex":"BC8804FF","ID":5767},{"Name":"Colibri Pink Dye","Hex":"DC9BCAFF","ID":5811},{"Name":"Coral Pink Dye","Hex":"CC6C5EFF","ID":5741},{"Name":"Cork Brown Dye","Hex":"C99156FF","ID":5750},{"Name":"Corpse Blue Dye","Hex":"8E9BACFF","ID":5793},{"Name":"Cream Yellow Dye","Hex":"F2D770FF","ID":5768},{"Name":"Currant Purple Dye","Hex":"322C3BFF","ID":5807},{"Name":"Dalamud Red Dye","Hex":"781A1AFF","ID":5738},{"Name":"Deepwood Green Dye","Hex":"1E2A21FF","ID":5784},{"Name":"Desert Yellow Dye","Hex":"DBB457FF","ID":5764},{"Name":"Dragoon Blue Dye","Hex":"000EA2FF","ID":30120},{"Name":"Gloom Purple Dye","Hex":"514560FF","ID":5806},{"Name":"Gobbiebag Brown Dye","Hex":"B9A489FF","ID":5758},{"Name":"Goobbue Grey Dye","Hex":"898784FF","ID":5731},{"Name":"Grape Purple Dye","Hex":"3B2A3DFF","ID":5809},{"Name":"Halatali Yellow Dye","Hex":"A58430FF","ID":5769},{"Name":"Honey Yellow Dye","Hex":"FAC62BFF","ID":5765},{"Name":"Hunter Green Dye","Hex":"284B2CFF","ID":5780},{"Name":"Ice Blue Dye","Hex":"B2C4CEFF","ID":5788},{"Name":"Ink Blue Dye","Hex":"1A1F27FF","ID":5796},{"Name":"Iris Purple Dye","Hex":"B79EBCFF","ID":5808},{"Name":"Kobold Brown Dye","Hex":"30211BFF","ID":5749},{"Name":"Lavender Purple Dye","Hex":"877FAEFF","ID":5805},{"Name":"Lilac Purple Dye","Hex":"836969FF","ID":5736},{"Name":"Lime Green Dye","Hex":"ABB054FF","ID":5773},{"Name":"Loam Brown Dye","Hex":"3F3329FF","ID":5761},{"Name":"Lotus Pink Dye","Hex":"FECEF5FF","ID":5810},{"Name":"Marsh Green Dye","Hex":"323621FF","ID":5777},{"Name":"Meadow Green Dye","Hex":"8B9C63FF","ID":5775},{"Name":"Mesa Red Dye","Hex":"7D3906FF","ID":5745},{"Name":"Midnight Blue Dye","Hex":"181937FF","ID":5802},{"Name":"Millioncorn Yellow Dye","Hex":"E49E34FF","ID":5766},{"Name":"Mole Brown Dye","Hex":"615245FF","ID":5760},{"Name":"Morbol Green Dye","Hex":"1F4646FF","ID":5787},{"Name":"Moss Green Dye","Hex":"707326FF","ID":5774},{"Name":"Mud Green Dye","Hex":"585230FF","ID":5771},{"Name":"Nophica Green Dye","Hex":"3B4D3CFF","ID":5783},{"Name":"Ochu Green Dye","Hex":"406339FF","ID":5781},{"Name":"Olive Green Dye","Hex":"4B5232FF","ID":5776},{"Name":"Opo-opo Brown Dye","Hex":"7B5C2DFF","ID":5752},{"Name":"Orchard Brown Dye","Hex":"644216FF","ID":5756},{"Name":"Othard Blue Dye","Hex":"2F5889FF","ID":5798},{"Name":"Peacock Blue Dye","Hex":"3B6886FF","ID":5791},{"Name":"Plum Purple Dye","Hex":"79526CFF","ID":5812},{"Name":"Pumpkin Orange Dye","Hex":"C57424FF","ID":5754},{"Name":"Qiqirn Brown Dye","Hex":"996E3FFF","ID":5751},{"Name":"Raisin Brown Dye","Hex":"403311FF","ID":5770},{"Name":"Raptor Blue Dye","Hex":"5B7FC0FF","ID":5797},{"Name":"Regal Purple Dye","Hex":"66304EFF","ID":5813},{"Name":"Rhotano Blue Dye","Hex":"1C3D54FF","ID":5792},{"Name":"Rolanberry Red Dye","Hex":"5B1729FF","ID":5737},{"Name":"Rose Pink Dye","Hex":"E69F96FF","ID":5735},{"Name":"Royal Blue Dye","Hex":"273067FF","ID":5801},{"Name":"Ruby Red Dye","Hex":"E40011FF","ID":30116},{"Name":"Russet Brown Dye","Hex":"4F2D1FFF","ID":5748},{"Name":"Rust Red Dye","Hex":"622207FF","ID":5739},{"Name":"Salmon Pink Dye","Hex":"E4AA8AFF","ID":5743},{"Name":"Seafog Blue Dye","Hex":"6481A0FF","ID":5790},{"Name":"Shadow Blue Dye","Hex":"373747FF","ID":5803},{"Name":"Shale Brown Dye","Hex":"92816CFF","ID":5759},{"Name":"Sky Blue Dye","Hex":"83B0D2FF","ID":5789},{"Name":"Slate Grey Dye","Hex":"656565FF","ID":5732},{"Name":"Snow White Dye","Hex":"E4DFD0FF","ID":5729},{"Name":"Soot Black Dye","Hex":"2B2923FF","ID":5734},{"Name":"Storm Blue Dye","Hex":"234172FF","ID":5799},{"Name":"Sunset Orange Dye","Hex":"B75C2DFF","ID":5744},{"Name":"Sylph Green Dye","Hex":"BBBB8AFF","ID":5772},{"Name":"Turquoise Blue Dye","Hex":"04AFCDFF","ID":30121},{"Name":"Turquoise Green Dye","Hex":"437272FF","ID":5786},{"Name":"Ul Brown Dye","Hex":"B7A370FF","ID":5763},{"Name":"Vanilla Yellow Dye","Hex":"FBF1B4FF","ID":30119},{"Name":"Void Blue Dye","Hex":"112944FF","ID":5800},{"Name":"Wine Red Dye","Hex":"451511FF","ID":5740},{"Name":"Woad Blue Dye","Hex":"2F3851FF","ID":5795},{"Name":"General-purpose Dark Blue Dye","Hex":"232026FF","ID":13714},{"Name":"General-purpose Dark Brown Dye","Hex":"28211CFF","ID":13710},{"Name":"General-purpose Dark Green Dye","Hex":"152C2CFF","ID":13712},{"Name":"General-purpose Dark Purple Dye","Hex":"232026FF","ID":13716},{"Name":"General-purpose Dark Red Dye","Hex":"321919FF","ID":13709},{"Name":"General-purpose Jet Black Dye","Hex":"1E1E1EFF","ID":13115},{"Name":"General-purpose Pastel Blue Dye","Hex":"96A4D9FF","ID":13713},{"Name":"General-purpose Pastel Green Dye","Hex":"BACFAAFF","ID":13711},{"Name":"General-purpose Pastel Pink Dye","Hex":"FDC8C6FF","ID":13708},{"Name":"General-purpose Pastel Purple Dye","Hex":"BBB5DAFF","ID":13715},{"Name":"General-purpose Pure White Dye","Hex":"F9F8F4FF","ID":13114}]
    </script>
  </head>
  <body x-data="MakeplaceToTeamcraft()">
    <input type="file" id="file-input" @change="fileChosen" />
    <br>
    <template x-if="path">
      <a :href="path">Open in teamcraft</a>
    </template>

    <script defer>
      function MakeplaceToTeamcraft() {
        var json
        var dyes

        return {
          interiorFurniture: [],
          interiorFurnitureDyes: [],
          interiorFixture: [],
          interiorFixtureDyes: [],
          exteriorFurniture: [],
          exteriorFurnitureDyes: [],
          exteriorFixture: [],
          exteriorFixtureDyes: [],
          path: "",
          fileChosen(event) {
            this.readSingleFile(event, src => this.path = src)
          },
          readSingleFile(e, callback) {
            this.path = ""
            let file = e.target.files[0]
            if (!file) { return; }

            let reader = new FileReader();
            reader.onload = e => {
              let contents = e.target.result;
              json = JSON.parse(contents)

              this.interiorFurniture = json.interiorFurniture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.interiorFixture = json.interiorFixture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.interiorFurnitureDyes = json.interiorFurniture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i.properties.color)[0].ID )
              this.interiorFixtureDyes = json.interiorFixture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i.properties.color)[0].ID )

              this.exteriorFurniture = json.exteriorFurniture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.exteriorFixture = json.exteriorFixture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.exteriorFurnitureDyes = json.exteriorFurniture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i?.properties?.color)[0].ID )
              this.exteriorFixtureDyes = json.exteriorFixture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i?.properties?.color)[0].ID )

              let formattedJson = this.interiorFurniture.concat(this.interiorFixture, this.interiorFixtureDyes, this.interiorFurnitureDyes, this.exteriorFurniture, this.exteriorFixture, this.exteriorFurnitureDyes, this.exteriorFixtureDyes).reduce((p, c) => { p[c] = (p[c] || 0) + 1; return p }, {})
              let importJson = Object.entries(formattedJson).map(([k,v]) => `${k},null,${v}`).join(';')
              callback("https://ffxivteamcraft.com/import/" + btoa(importJson))
            }

            reader.readAsText(file);
          },
          init() {
            dyes = JSON.parse($('#dyes').text())           
          }
        }
      }
    </script>
  </body>
</html>
