<!DOCTYPE html>
  <head>
    <title>MakeplaceToTeamcraft</title>
    <meta charset="utf8">
    <script src="https://unpkg.com/alpinejs@3.3.3/dist/cdn.min.js" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script id="dyes" type="application/json">
      [{"Name":"Abyssal Blue Dye","Hex":"312D57","ID":5804},{"Name":"Acorn Brown Dye","Hex":"8E581B","ID":5755},{"Name":"Adamantoise Green Dye","Hex":"5F7558","ID":5782},{"Name":"Aldgoat Brown Dye","Hex":"A2875C","ID":5753},{"Name":"Apple Green Dye","Hex":"9BB363","ID":5778},{"Name":"Ash Grey Dye","Hex":"ACA8A2","ID":5730},{"Name":"Bark Brown Dye","Hex":"6A4B37","ID":5746},{"Name":"Blood Red Dye","Hex":"913B27","ID":5742},{"Name":"Bone White Dye","Hex":"EBD3A0","ID":5762},{"Name":"Cactuar Green Dye","Hex":"658241","ID":5779},{"Name":"Canary Yellow Dye","Hex":"FEF864","ID":30118},{"Name":"Celeste Green Dye","Hex":"96BDB9","ID":5785},{"Name":"Ceruleum Blue Dye","Hex":"4F5766","ID":5794},{"Name":"Charcoal Grey Dye","Hex":"484742","ID":5733},{"Name":"Cherry Pink Dye","Hex":"F5379B","ID":30117},{"Name":"Chestnut Brown Dye","Hex":"3D290D","ID":5757},{"Name":"Chocolate Brown Dye","Hex":"6E3D24","ID":5747},{"Name":"Coeurl Yellow Dye","Hex":"BC8804","ID":5767},{"Name":"Colibri Pink Dye","Hex":"DC9BCA","ID":5811},{"Name":"Coral Pink Dye","Hex":"CC6C5E","ID":5741},{"Name":"Cork Brown Dye","Hex":"C99156","ID":5750},{"Name":"Corpse Blue Dye","Hex":"8E9BAC","ID":5793},{"Name":"Cream Yellow Dye","Hex":"F2D770","ID":5768},{"Name":"Currant Purple Dye","Hex":"322C3B","ID":5807},{"Name":"Dalamud Red Dye","Hex":"781A1A","ID":5738},{"Name":"Deepwood Green Dye","Hex":"1E2A21","ID":5784},{"Name":"Desert Yellow Dye","Hex":"DBB457","ID":5764},{"Name":"Dragoon Blue Dye","Hex":"000EA2","ID":30120},{"Name":"Gloom Purple Dye","Hex":"514560","ID":5806},{"Name":"Gobbiebag Brown Dye","Hex":"B9A489","ID":5758},{"Name":"Goobbue Grey Dye","Hex":"898784","ID":5731},{"Name":"Grape Purple Dye","Hex":"3B2A3D","ID":5809},{"Name":"Halatali Yellow Dye","Hex":"A58430","ID":5769},{"Name":"Honey Yellow Dye","Hex":"FAC62B","ID":5765},{"Name":"Hunter Green Dye","Hex":"284B2C","ID":5780},{"Name":"Ice Blue Dye","Hex":"B2C4CE","ID":5788},{"Name":"Ink Blue Dye","Hex":"1A1F27","ID":5796},{"Name":"Iris Purple Dye","Hex":"B79EBC","ID":5808},{"Name":"Kobold Brown Dye","Hex":"30211B","ID":5749},{"Name":"Lavender Purple Dye","Hex":"877FAE","ID":5805},{"Name":"Lilac Purple Dye","Hex":"836969","ID":5736},{"Name":"Lime Green Dye","Hex":"ABB054","ID":5773},{"Name":"Loam Brown Dye","Hex":"3F3329","ID":5761},{"Name":"Lotus Pink Dye","Hex":"FECEF5","ID":5810},{"Name":"Marsh Green Dye","Hex":"323621","ID":5777},{"Name":"Meadow Green Dye","Hex":"8B9C63","ID":5775},{"Name":"Mesa Red Dye","Hex":"7D3906","ID":5745},{"Name":"Midnight Blue Dye","Hex":"181937","ID":5802},{"Name":"Millioncorn Yellow Dye","Hex":"E49E34","ID":5766},{"Name":"Mole Brown Dye","Hex":"615245","ID":5760},{"Name":"Morbol Green Dye","Hex":"1F4646","ID":5787},{"Name":"Moss Green Dye","Hex":"707326","ID":5774},{"Name":"Mud Green Dye","Hex":"585230","ID":5771},{"Name":"Nophica Green Dye","Hex":"3B4D3C","ID":5783},{"Name":"Ochu Green Dye","Hex":"406339","ID":5781},{"Name":"Olive Green Dye","Hex":"4B5232","ID":5776},{"Name":"Opo-opo Brown Dye","Hex":"7B5C2D","ID":5752},{"Name":"Orchard Brown Dye","Hex":"644216","ID":5756},{"Name":"Othard Blue Dye","Hex":"2F5889","ID":5798},{"Name":"Peacock Blue Dye","Hex":"3B6886","ID":5791},{"Name":"Plum Purple Dye","Hex":"79526C","ID":5812},{"Name":"Pumpkin Orange Dye","Hex":"C57424","ID":5754},{"Name":"Qiqirn Brown Dye","Hex":"996E3F","ID":5751},{"Name":"Raisin Brown Dye","Hex":"403311","ID":5770},{"Name":"Raptor Blue Dye","Hex":"5B7FC0","ID":5797},{"Name":"Regal Purple Dye","Hex":"66304E","ID":5813},{"Name":"Rhotano Blue Dye","Hex":"1C3D54","ID":5792},{"Name":"Rolanberry Red Dye","Hex":"5B1729","ID":5737},{"Name":"Rose Pink Dye","Hex":"E69F96","ID":5735},{"Name":"Royal Blue Dye","Hex":"273067","ID":5801},{"Name":"Ruby Red Dye","Hex":"E40011","ID":30116},{"Name":"Russet Brown Dye","Hex":"4F2D1F","ID":5748},{"Name":"Rust Red Dye","Hex":"622207","ID":5739},{"Name":"Salmon Pink Dye","Hex":"E4AA8A","ID":5743},{"Name":"Seafog Blue Dye","Hex":"6481A0","ID":5790},{"Name":"Shadow Blue Dye","Hex":"373747","ID":5803},{"Name":"Shale Brown Dye","Hex":"92816C","ID":5759},{"Name":"Sky Blue Dye","Hex":"83B0D2","ID":5789},{"Name":"Slate Grey Dye","Hex":"656565","ID":5732},{"Name":"Snow White Dye","Hex":"E4DFD0","ID":5729},{"Name":"Soot Black Dye","Hex":"2B2923","ID":5734},{"Name":"Storm Blue Dye","Hex":"234172","ID":5799},{"Name":"Sunset Orange Dye","Hex":"B75C2D","ID":5744},{"Name":"Sylph Green Dye","Hex":"BBBB8A","ID":5772},{"Name":"Turquoise Blue Dye","Hex":"04AFCD","ID":30121},{"Name":"Turquoise Green Dye","Hex":"437272","ID":5786},{"Name":"Ul Brown Dye","Hex":"B7A370","ID":5763},{"Name":"Vanilla Yellow Dye","Hex":"FBF1B4","ID":30119},{"Name":"Void Blue Dye","Hex":"112944","ID":5800},{"Name":"Wine Red Dye","Hex":"451511","ID":5740},{"Name":"Woad Blue Dye","Hex":"2F3851","ID":5795},{"Name":"General-purpose Dark Blue Dye","Hex":"232026","ID":13714},{"Name":"General-purpose Dark Brown Dye","Hex":"28211C","ID":13710},{"Name":"General-purpose Dark Green Dye","Hex":"152C2C","ID":13712},{"Name":"General-purpose Dark Purple Dye","Hex":"232026","ID":13716},{"Name":"General-purpose Dark Red Dye","Hex":"321919","ID":13709},{"Name":"General-purpose Jet Black Dye","Hex":"1E1E1E","ID":13115},{"Name":"General-purpose Pastel Blue Dye","Hex":"96A4D9","ID":13713},{"Name":"General-purpose Pastel Green Dye","Hex":"BACFAA","ID":13711},{"Name":"General-purpose Pastel Pink Dye","Hex":"FDC8C6","ID":13708},{"Name":"General-purpose Pastel Purple Dye","Hex":"BBB5DA","ID":13715},{"Name":"General-purpose Pure White Dye","Hex":"F9F8F4","ID":13114}]
    </script>
  </head>
  <body x-data="MakeplaceToTeamcraft()">
    <input type="file" id="file-input" @change="fileChosen" />
    <br>
    <template x-if="path">
      <a :href="path">Open in teamcraft</a>
    </template>

    <script defer>
      function MakeplaceToTeamcraft() {
        var json
        var dyes

        return {
          interiorFurniture: [],
          interiorFurnitureDyes: [],
          interiorFixture: [],
          interiorFixtureDyes: [],
          exteriorFurniture: [],
          exteriorFurnitureDyes: [],
          exteriorFixture: [],
          exteriorFixtureDyes: [],
          path: "",
          fileChosen(event) {
            this.readSingleFile(event, src => this.path = src)
          },
          readSingleFile(e, callback) {
            this.path = ""
            let file = e.target.files[0]
            if (!file) { return; }

            let reader = new FileReader();
            reader.onload = e => {
              let contents = e.target.result;
              json = JSON.parse(contents)

              this.interiorFurniture = json.interiorFurniture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.interiorFixture = json.interiorFixture.filter(item => item.itemId != 0 && item.type != 'District').map(i => i.itemId)
              this.interiorFurnitureDyes = json.interiorFurniture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i?.properties?.color?.slice(0, -2))[0].ID )
              this.interiorFixtureDyes = json.interiorFixture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i?.properties?.color?.slice(0, -2))[0].ID )

              this.exteriorFurniture = json.exteriorFurniture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.exteriorFixture = json.exteriorFixture.filter(item => item.itemId != 0).map(i => i.itemId)
              this.exteriorFurnitureDyes = json.exteriorFurniture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i?.properties?.color?.slice(0, -2))[0].ID )
              this.exteriorFixtureDyes = json.exteriorFixture.filter(i => i?.properties?.color).map(i => dyes.filter(d => d.Hex == i?.properties?.color?.slice(0, -2))[0].ID )

              let formattedJson = this.interiorFurniture.concat(this.interiorFixture, this.interiorFixtureDyes, this.interiorFurnitureDyes, this.exteriorFurniture, this.exteriorFixture, this.exteriorFurnitureDyes, this.exteriorFixtureDyes).reduce((p, c) => { p[c] = (p[c] || 0) + 1; return p }, {})
              let importJson = Object.entries(formattedJson).map(([k,v]) => `${k},null,${v}`).join(';')

              callback("https://ffxivteamcraft.com/import/" + btoa(importJson))
            }

            reader.readAsText(file);
          },
          init() {
            dyes = JSON.parse($('#dyes').text())           
          }
        }
      }
    </script>
  </body>
</html>


